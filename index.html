<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="SafePatch turns a risky LLM hotfix into a guardrail-safe patch and returns a ship or hold decision with impact estimates."
    />
    <title>SafePatch | Release Check</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@500;600&family=Newsreader:opsz,wght@6..72,500;6..72,600;6..72,700&family=Sora:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <main class="product">
      <header class="intro">
        <p class="eyebrow">SafePatch release check</p>
        <h1>From risky hotfix to a defensible ship or hold decision.</h1>
        <p class="intro-text">
          Raw patches can fix one issue while violating safety checks. SafePatch projects the raw update to the nearest
          feasible update, then replays expected queue load so you can decide with evidence.
        </p>
      </header>

      <section class="workspace">
        <section class="stage" aria-label="SafePatch simulation stage">
          <div class="stage-head">
            <p class="stage-kicker">Mechanism proof</p>
            <p id="stage-caption" class="stage-caption">Run release check to simulate raw patch, projection, and queue impact.</p>
          </div>

          <div class="proof-canvas">
            <canvas id="scene-canvas" class="scene" aria-label="Raw patch and projected safe patch simulation"></canvas>
          </div>

          <section id="decision-panel" class="decision-banner hold">
            <div class="status-copy">
              <p id="decision-pill" class="decision-pill hold">HOLD</p>
              <h2 id="decision-title">Run release check</h2>
              <p id="decision-detail" class="status-detail">Use presets and run the simulation to get a decision and rationale.</p>
            </div>

            <div class="status-side" aria-label="Readiness score">
              <p class="status-label">Readiness</p>
              <strong id="readiness-score" class="readiness-score">--</strong>
              <p id="readiness-note" class="status-note">Awaiting simulation.</p>
            </div>
          </section>

          <section class="scoreboard" aria-label="Decision metrics">
            <article class="score-card">
              <p class="score-label">Checks passed</p>
              <strong id="checks-passed" class="score-value">--</strong>
            </article>
            <article class="score-card">
              <p class="score-label">Expected peak queue</p>
              <strong id="queue-peak" class="score-value">--</strong>
            </article>
            <article class="score-card">
              <p class="score-label">Useful gain kept</p>
              <strong id="retained-value" class="score-value">--</strong>
            </article>
          </section>
        </section>

        <aside class="controls">
          <p class="controls-kicker">Scenario</p>
          <h2>Run release check</h2>
          <p class="controls-intro">Choose a preset, adjust advanced knobs if needed, then run.</p>

          <div class="field-card">
            <p class="field-title">Traffic preset</p>
            <div class="scenario-buttons" role="group" aria-label="Traffic preset">
              <button class="scenario-btn" data-pressure="0.22" type="button">Normal</button>
              <button class="scenario-btn active" data-pressure="0.56" type="button">Spike</button>
              <button class="scenario-btn" data-pressure="0.9" type="button">Incident</button>
            </div>
            <p id="scenario-note" class="field-note">Traffic spike: meaningful pressure, still recoverable.</p>
          </div>

          <button id="run-button" class="primary-btn" type="button">Run release check</button>

          <details class="advanced-panel">
            <summary>Advanced controls</summary>

            <div class="field-card">
              <div class="slider-row">
                <label for="urgency-slider">Hotfix urgency</label>
                <span id="urgency-value" class="slider-value">58%</span>
              </div>
              <input id="urgency-slider" type="range" min="0" max="100" value="58" />
              <p id="urgency-note" class="field-note">Balanced urgency: enough room to trade risk for reliability.</p>
            </div>

            <div class="field-card">
              <div class="slider-row">
                <label for="strictness-slider">Policy strictness</label>
                <span id="strictness-value" class="slider-value">62%</span>
              </div>
              <input id="strictness-slider" type="range" min="0" max="100" value="62" />
              <p id="strictness-note" class="field-note">Moderate strictness keeps core checks active.</p>
            </div>

            <div class="action-buttons">
              <button id="autotune-button" class="secondary-btn" type="button">Auto-set safest knobs</button>
              <button id="reset-button" class="secondary-btn" type="button">Reset controls</button>
              <button id="replay-button" class="secondary-btn" type="button">Replay animation</button>
            </div>

            <p id="recommended-controls" class="recommended-controls">
              Recommended settings appear after each simulation.
            </p>
          </details>

          <details class="explain-panel" open>
            <summary>Decision breakdown</summary>

            <div class="ops-grid">
              <article class="ops-card">
                <h3>Why this decision</h3>
                <ul id="why-list" class="ops-list">
                  <li>Run the simulation to generate rationale.</li>
                </ul>
              </article>
              <article class="ops-card">
                <h3>Rollout checks</h3>
                <ul id="gate-list" class="ops-list">
                  <li>Run the simulation to generate rollout gates.</li>
                </ul>
              </article>
            </div>

            <h3 class="mini-title">Execution steps</h3>
            <ul id="action-list" class="action-list">
              <li>Choose scenario and click Run release check.</li>
            </ul>

            <div class="memo-card">
              <div class="memo-head">
                <p class="field-title">Release memo</p>
                <button id="copy-memo-button" class="copy-memo" type="button">Copy memo</button>
              </div>
              <p id="memo-text" class="memo-text">Memo appears after simulation.</p>
            </div>

            <button id="export-button" class="export wide" type="button">Export decision JSON</button>
          </details>

          <details class="math-details">
            <summary>Projection math</summary>
            <section class="math-panel" aria-label="SafePatch optimization equations">
              <p class="math-intro">SafePatch keeps the update as close as possible to the raw step while satisfying all active checks.</p>
              <div class="equation-stack">
                <article class="equation-block">
                  <p class="equation-title">Raw update</p>
                  <div id="equation-raw" class="equation"></div>
                </article>
                <article class="equation-block">
                  <p class="equation-title">Safe projection</p>
                  <div id="equation-qp" class="equation"></div>
                </article>
              </div>
            </section>
          </details>
        </aside>
      </section>
    </main>

    <script type="module" src="./src/main.ts"></script>
  </body>
</html>
