<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="SafePatch lets release teams drag a candidate hotfix direction and instantly see the safest certifiable version, policy blockers, and ship/hold decision."
    />
    <title>SafePatch | Release Decision Studio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@500;600&family=Newsreader:opsz,wght@6..72,600;6..72,700&family=Sora:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <main class="app-shell">
      <header class="hero">
        <p class="eyebrow">SafePatch Release Control</p>
        <h1>Ship faster without shipping unsafe patches.</h1>
        <p class="hero-copy">
          Teams propose a hotfix direction that looks good locally but can violate production guardrails. SafePatch keeps as
          much of that fix as possible, removes only the unsafe component, and returns a clear ship/hold decision.
        </p>
        <div class="hero-points" aria-label="What SafePatch does">
          <p><strong>Problem:</strong> raw hotfix directions can spike incidents.</p>
          <p><strong>Method:</strong> project to nearest guardrail-safe direction.</p>
          <p><strong>Value:</strong> instant decision with actionable blocker reason.</p>
        </div>
      </header>

      <section class="workspace" aria-label="Release workspace">
        <div class="workflow-bar">
          <div class="workflow-intro">
            <p class="workflow-title">How to use</p>
            <p class="workflow-copy">Choose traffic context, drag the red patch, then read the certified blue outcome.</p>
          </div>
          <div class="workflow-steps" role="list" aria-label="Workflow steps">
            <span class="workflow-step" role="listitem">1. Scenario</span>
            <span class="workflow-step" role="listitem">2. Drag proposal</span>
            <span class="workflow-step" role="listitem">3. Review certified patch</span>
          </div>
          <div class="stage-key" aria-label="Canvas legend">
            <span class="key-item"><i class="key-dot proposed"></i>Proposed</span>
            <span class="key-item"><i class="key-dot correction"></i>Correction</span>
            <span class="key-item"><i class="key-dot certified"></i>Certified</span>
          </div>
        </div>

        <section class="control-ribbon" aria-label="Simulation controls">
          <article class="control-pane">
            <p class="panel-kicker">Traffic Condition</p>
            <div class="preset-row" role="group" aria-label="Traffic scenario presets">
              <button class="preset-btn" data-preset="normal" data-pressure="0.24" type="button">Business Usual</button>
              <button class="preset-btn active" data-preset="spike" data-pressure="0.56" type="button">Peak Traffic</button>
              <button class="preset-btn" data-preset="incident" data-pressure="0.9" type="button">Live Incident</button>
            </div>
            <p id="preset-note" class="preset-note">Peak traffic: release decisions need stronger policy correction.</p>
          </article>

          <article class="control-pane">
            <p class="panel-kicker">Risk Tolerance</p>
            <section class="tightness-block">
              <div class="tightness-head">
                <label for="tightness-slider">Policy strictness</label>
                <span id="tightness-value" class="tightness-value">62%</span>
              </div>
              <input id="tightness-slider" type="range" min="20" max="90" value="62" />
            </section>
          </article>

          <article class="control-pane action-pane">
            <p class="panel-kicker">View</p>
            <div class="mode-toggle" role="group" aria-label="Visualization mode">
              <button class="mode-btn active" data-mode="geometry" type="button">Release Preview</button>
              <button class="mode-btn" data-mode="forces" type="button">Policy Forces</button>
            </div>
            <button id="replay-button" class="replay-btn" type="button">Replay onboarding</button>
          </article>
        </section>

        <section class="stage-card" aria-label="SafePatch interaction stage">
          <div class="stage-header">
            <p id="stage-caption" class="stage-caption">
              Drag the red candidate patch. SafePatch continuously returns the nearest certifiable release direction.
            </p>
          </div>

          <canvas id="scene-canvas" class="scene-canvas" aria-label="Patch proposal stage and policy correction view"></canvas>

          <p id="drag-hint" class="drag-hint">Direct manipulation: drag the red patch endpoint to simulate a real release proposal.</p>

          <section class="impact-strip" aria-label="Immediate interaction impact">
            <article class="impact-card">
              <p class="impact-label">Patch Trimmed</p>
              <strong id="impact-correction" class="impact-value">--</strong>
            </article>
            <article class="impact-card">
              <p class="impact-label">Incidents Avoided</p>
              <strong id="impact-risk" class="impact-value">--</strong>
            </article>
            <article class="impact-card">
              <p class="impact-label">Top Blocker</p>
              <strong id="impact-blocker" class="impact-value impact-blocker">--</strong>
            </article>
          </section>

          <section id="force-bars" class="force-bars" aria-label="Constraint correction strengths"></section>
        </section>

        <section class="outcome-strip" aria-label="Decision outcome">
          <article id="decision-panel" class="outcome-card decision-card hold">
            <p id="decision-pill" class="decision-pill hold">HOLD</p>
            <h2 id="decision-title">Hold: current direction is unsafe</h2>
            <p id="decision-detail">Adjust the patch direction until all policies pass with acceptable rollout impact.</p>
          </article>

          <article class="outcome-card">
            <p class="metric-label">Policies Passed</p>
            <strong id="checks-passed" class="metric-value">--</strong>
            <p id="readiness-note" class="metric-note">Release confidence: --</p>
          </article>

          <article class="outcome-card">
            <p class="metric-label">Incident Forecast</p>
            <strong id="queue-peak" class="metric-value">--</strong>
            <p class="metric-note">Proposed -> Certified</p>
          </article>

          <article class="outcome-card">
            <p class="metric-label">Fix Value Retained</p>
            <strong id="retained-value" class="metric-value">--</strong>
            <p class="metric-note">Useful gain preserved after safety trim</p>
          </article>
        </section>
      </section>

      <details class="details-panel">
        <summary>Details: rationale, memo, math, export</summary>

        <section class="details-grid">
          <article class="detail-card">
            <h3>Why this decision</h3>
            <ul id="why-list" class="detail-list">
              <li>Start dragging to generate rationale.</li>
            </ul>
          </article>

          <article class="detail-card">
            <h3>Recommended actions</h3>
            <ul id="action-list" class="detail-list">
              <li>Adjust patch direction directly on the stage.</li>
            </ul>
          </article>
        </section>

        <section class="memo-card">
          <div class="memo-head">
            <p class="memo-title">Release memo</p>
            <button id="copy-memo-button" class="mini-btn" type="button">Copy memo</button>
          </div>
          <p id="memo-text" class="memo-text">Memo updates as you interact.</p>
          <button id="export-button" class="export-btn" type="button">Export decision JSON</button>
        </section>

        <section class="math-card">
          <h3>Optional math view</h3>
          <div id="equation-main" class="equation"></div>
          <div id="equation-sub" class="equation equation-sub"></div>
          <div id="equation-terms" class="equation-terms"></div>
          <p class="math-note">Each active term maps to one policy correction in Policy Forces view.</p>
        </section>
      </details>
    </main>

    <script type="module" src="./src/main.ts"></script>
  </body>
</html>
