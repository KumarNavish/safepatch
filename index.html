<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="SafePatch is an interactive release gate: drag a raw fix proposal, see the certified patch, and get an immediate ship or hold recommendation."
    />
    <title>SafePatch | Release Gate Studio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@500;600&family=Manrope:wght@400;500;600;700&family=Instrument+Serif:ital@0;1&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <main class="shell">
      <header class="hero" aria-label="SafePatch introduction">
        <p class="brand">SafePatch</p>
        <h1>Release fixes fast, without breaking guardrails.</h1>
        <p class="hero-copy">
          Drag the red proposal in the stage. SafePatch instantly projects a certifiable patch in blue and updates
          ship/hold with a concrete reason.
        </p>
      </header>

      <section class="workspace" aria-label="SafePatch studio">
        <section class="stage" aria-label="Interactive release stage">
          <div class="stage-top">
            <div class="mode-toggle" role="group" aria-label="View mode">
              <button class="mode-btn active" data-mode="geometry" type="button">Flow view</button>
              <button class="mode-btn" data-mode="forces" type="button">Forces view</button>
            </div>
            <button id="replay-button" class="replay-btn" type="button">Replay walkthrough</button>
          </div>

          <p id="stage-hint" class="stage-hint">Drag the red tip. Blue updates to the safest certifiable direction.</p>

          <canvas id="scene-canvas" class="scene-canvas" aria-label="Raw patch and safe projection"></canvas>

          <p id="stage-caption" class="stage-caption">Step 1: intake raw proposal.</p>
        </section>

        <aside id="sidebar" class="cockpit" aria-label="Live release guide">
          <article class="now-card" aria-live="polite">
            <p class="kicker">Now</p>
            <h2 id="now-title">Proposal intake</h2>
            <p id="now-body">SafePatch is reading the raw patch direction.</p>
            <p id="now-reason" class="now-reason">No recommendation yet.</p>
          </article>

          <article id="decision-card" class="decision-card hold" aria-live="polite">
            <p id="decision-pill" class="decision-pill hold">HOLD</p>
            <h3 id="decision-title">Hold: raw direction is not certifiable yet</h3>
            <p id="decision-detail">Adjust direction until checks pass with enough retained product value.</p>
            <p id="readiness-note" class="readiness-note">Release confidence: --</p>
          </article>

          <section class="score-strip" aria-label="Outcome summary">
            <article class="score-card">
              <p class="score-label">Certified checks</p>
              <strong id="checks-value" class="score-value">--</strong>
            </article>
            <article class="score-card">
              <p class="score-label">Incident forecast</p>
              <strong id="incident-value" class="score-value">--</strong>
            </article>
            <article class="score-card">
              <p class="score-label">Useful gain kept</p>
              <strong id="retained-value" class="score-value">--</strong>
            </article>
          </section>

          <article id="pipeline-card" class="pipeline-card" aria-label="Pipeline playback">
            <div class="pipeline-head">
              <p class="kicker">Pipeline</p>
              <p id="impact-line" class="impact-line">Raw versus certified impact appears here.</p>
            </div>

            <div id="pipeline" class="pipeline" aria-live="polite">
              <article class="pipe-step" data-step="0">
                <span class="pipe-dot" aria-hidden="true"></span>
                <div class="pipe-copy">
                  <p class="pipe-title">1. Intake proposal</p>
                  <p id="pipe-line-0" class="pipe-line">Waiting for patch direction.</p>
                </div>
              </article>
              <article class="pipe-step" data-step="1">
                <span class="pipe-dot" aria-hidden="true"></span>
                <div class="pipe-copy">
                  <p class="pipe-title">2. Detect guardrail risk</p>
                  <p id="pipe-line-1" class="pipe-line">No active guardrail pressure.</p>
                </div>
              </article>
              <article class="pipe-step" data-step="2">
                <span class="pipe-dot" aria-hidden="true"></span>
                <div class="pipe-copy">
                  <p class="pipe-title">3. Project safe patch</p>
                  <p id="pipe-line-2" class="pipe-line">No correction applied.</p>
                </div>
              </article>
              <article class="pipe-step" data-step="3">
                <span class="pipe-dot" aria-hidden="true"></span>
                <div class="pipe-copy">
                  <p class="pipe-title">4. Recommend action</p>
                  <p id="pipe-line-3" class="pipe-line">Decision pending.</p>
                </div>
              </article>
            </div>
          </article>

          <section id="force-bars" class="force-bars" aria-label="Constraint correction pressure"></section>

          <details class="controls">
            <summary>Scenario controls</summary>
            <div class="controls-body">
              <div class="preset-row" role="group" aria-label="Traffic scenario">
                <button class="preset-btn" data-preset="normal" data-pressure="0.24" type="button">Normal</button>
                <button class="preset-btn active" data-preset="spike" data-pressure="0.56" type="button">Spike</button>
                <button class="preset-btn" data-preset="incident" data-pressure="0.9" type="button">Incident</button>
              </div>
              <p id="preset-note" class="preset-note">Peak traffic makes guardrail correction pressure rise faster.</p>

              <label for="tightness-slider" class="tightness-label">Guardrail tightness <span id="tightness-value">62%</span></label>
              <input id="tightness-slider" type="range" min="20" max="90" value="62" />
            </div>
          </details>
        </aside>
      </section>

      <details class="details-panel">
        <summary>Details</summary>

        <section class="details-grid">
          <article class="detail-card">
            <h4>Why this decision</h4>
            <ul id="why-list" class="detail-list">
              <li>Interact with the stage to generate rationale.</li>
            </ul>
          </article>

          <article class="detail-card">
            <h4>Recommended next steps</h4>
            <ul id="action-list" class="detail-list">
              <li>Drag the red proposal to test alternatives.</li>
            </ul>
          </article>
        </section>

        <section class="memo-card">
          <div class="memo-head">
            <p class="kicker">Release memo</p>
            <button id="copy-memo-button" class="small-btn" type="button">Copy memo</button>
          </div>
          <p id="memo-text" class="memo-text">Memo updates as you interact.</p>
          <button id="export-button" class="small-btn" type="button">Export decision JSON</button>
        </section>

        <section class="math-card">
          <h4>Math (optional)</h4>
          <div id="equation-main" class="equation"></div>
          <div id="equation-sub" class="equation"></div>
          <div id="equation-terms" class="equation-terms"></div>
          <p class="math-note">Each active term maps to one correction force in Forces view.</p>
        </section>
      </details>
    </main>

    <script type="module" src="./src/main.ts"></script>
  </body>
</html>
